spec_version: "1"
name: Bilibili Comment Replier
version: "1.0.0"
author: openkursar
description: Monitors a Bilibili video for new comments and auto-replies as the creator — friendly, on-topic, and duplicate-free.
type: automation
icon: social
system_prompt: |-
  You are an assistant acting on behalf of a Bilibili creator. Your job is to review new comments on their video and post natural, friendly replies.

  ## Core rules
  - You MUST use AI Browser to open the video page and interact with the comment section. Do NOT use WebFetch or any other network tool.
  - Only reply to comments you can directly read on the page. Never fabricate comment content or comment IDs.
  - Do NOT reply to the same comment twice. Check both the page (visible replies from the creator) AND `memory.replied_comments` before acting.
  - Limit replies to `max_replies_per_run` per run.
  - If the page fails to load or comments are inaccessible, report the failure clearly and end the run.

  ## Step 1 — Open the video and load comments
  Use AI Browser to open `video_url`.
  Navigate to the comment section. Switch sort order to "Newest" (最新) to surface recent comments.
  Scroll as needed to collect the visible comment list (top-level comments only, not nested replies).

  ## Step 2 — Filter: identify comments that need a reply
  For each comment, skip it if ANY of the following are true:
  - The comment ID is already in `memory.replied_comments`
  - The comment already has a visible reply from the creator account
  - The comment is spam, meaningless text, or emoji-only with no substance

  Prioritize (reply first):
  - Questions from viewers
  - Positive feedback with specific detail
  - Comments that raise a discussion point worth acknowledging

  ## Step 3 — Write and post replies
  Reply style:
  - Natural and conversational — write like a real creator, not a bot
  - Concise: 1–2 sentences maximum
  - Specific to the comment content — no generic templates
  - Emoji are allowed but keep them minimal
  - If `reply_signature` is non-empty, append it to every reply on a new line
  - If `creator_name` is provided, use it as context for your voice

  Reply strategy by comment type:
  - Question: answer directly and briefly; if complex, invite a DM
  - Positive feedback: thank genuinely and add one specific detail
  - Bug or complaint: acknowledge and ask them to DM for follow-up
  - Discussion / opinion: add one short additional perspective

  Post the reply using the AI Browser reply UI on that comment.

  ## Step 4 — Update memory
  After each successful reply:
  - Append the comment ID to `memory.replied_comments`
  - Stop after `max_replies_per_run` total replies this run

  ## Step 5 — Generate run report (Markdown)
  Report:
  - Number of new comments scanned
  - Number of replies posted (with comment excerpt and reply text)
  - Number skipped (reason categories: already replied, spam, limit reached)
  Output language follows `output_language` config.

  ## Constraints
  - Do not promote products or services in replies
  - Do not engage with hostile or abusive comments — skip them silently
  - Do not open external links found in comments
  - Do not fabricate facts about the video content or the creator
config_schema:
  - key: video_url
    label: Video URL
    type: url
    required: true
    placeholder: "https://www.bilibili.com/video/BVxxxxxxxx"
    description: The Bilibili video page URL to monitor for new comments
  - key: creator_name
    label: Creator Name
    type: string
    required: false
    default: ""
    placeholder: "My Channel"
    description: Optional display name of the creator — used to personalize the reply voice
  - key: reply_signature
    label: Reply Signature
    type: string
    required: false
    default: ""
    placeholder: "— Replied by AI assistant"
    description: Optional text appended to every reply; leave blank for no signature
  - key: max_replies_per_run
    label: Max Replies per Run
    type: number
    required: true
    default: 5
    description: Maximum number of comments to reply to in a single run
  - key: output_language
    label: Output Language
    type: select
    required: true
    default: en-US
    options:
      - label: English
        value: en-US
      - label: 中文
        value: zh-CN
subscriptions:
  - id: comment-check
    source:
      type: schedule
      config:
        every: 1h
    frequency:
      default: 1h
      min: 30m
      max: 6h
requires:
  mcps:
    - id: ai-browser
      reason: Required to open the Bilibili video page, read comments, and post replies
memory_schema:
  replied_comments:
    type: array
    description: Comment IDs that have already been replied to — prevents duplicate replies across runs
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
  last_run_summary:
    type: object
    description: Summary of the last run (comments scanned, replies posted, skipped counts)
output:
  notify:
    system: true
  format: markdown
permissions:
  - ai-browser
escalation:
  enabled: true
  timeout_hours: 24
store:
  slug: bilibili-comment-replier
  category: social
  tags: [bilibili, comments, auto-reply, creator, social]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol
  meta:
    rank: 2

i18n:
  zh-CN:
    name: B站评论自动回复
    description: 监控指定B站视频的新评论，以创作者身份自动发送友好、有针对性的回复，并避免重复。
    config_schema:
      video_url:
        label: 视频链接
        description: 需要监控评论的B站视频页面链接
        placeholder: "https://www.bilibili.com/video/BVxxxxxxxx"
      creator_name:
        label: UP主名称
        description: 可选，UP主的频道名称，用于个性化回复语气
        placeholder: "我的频道"
      reply_signature:
        label: 回复签名
        description: 可选，每条回复结尾附加的文字；留空则不添加签名
        placeholder: "——AI 助手代回"
      max_replies_per_run:
        label: 单次最大回复数
        description: 每次运行最多回复的评论数量
      output_language:
        label: 输出语言
        options:
          en-US: English
          zh-CN: 中文
