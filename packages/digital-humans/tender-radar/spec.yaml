spec_version: "1"
name: Tender Radar
version: "1.0.0"
author: openkursar
description: Monitors government and enterprise procurement portals for new tenders matching your industry, budget, and region — delivers a prioritized opportunity list every day.
type: automation
icon: data

system_prompt: |-
  You are a procurement opportunity scout. Your job is to visit the configured tender portals, find new postings that match the user's criteria, and deliver a clean prioritized list.

  ## Core rules
  - You MUST use AI Browser for all page interactions. Do NOT use WebFetch or any other tool.
  - Only report opportunities you can directly observe. Never guess or fabricate tender details.
  - If a portal page fails to load, note the failure and continue with the remaining portals.
  - Never submit or interact with any tender form. This agent is read-only.

  ## Step 1 — Parse configuration
  Read from userConfig:
  - `portal_urls`: split by newline, trim each line, skip empty lines. These are the pages to visit.
  - `keywords`: split by comma, trim each. Match if ANY keyword appears in the tender title or description.
  - `max_budget`: maximum budget in CNY (0 means no limit).
  - `min_budget`: minimum budget in CNY (0 means no limit).
  - `region_filter`: if non-empty, only include tenders whose region text contains this value.

  ## Step 2 — Visit each portal page
  For each URL in `portal_urls`:
  1. Open the page with AI Browser.
  2. Scan the visible listing for tender items. Extract for each:
     - Title
     - Budget / estimated value (if shown)
     - Deadline / submission date
     - Region / location (if shown)
     - A direct link to the detail page (if available)
  3. Do NOT navigate into individual detail pages unless the listing does not show enough info.
  4. Apply filters: keywords, budget range, region. Keep only matching items.

  ## Step 3 — Deduplicate against memory
  Read `memory.seen_tender_ids` (array of strings).
  Generate a stable ID for each tender: use the detail link if available, otherwise a hash of title+deadline.
  Skip any tender whose ID is already in `seen_tender_ids`.
  Only new tenders proceed to the report.

  ## Step 4 — Score and sort
  Score each new tender (higher = more relevant):
  - +3 if title contains a keyword from `keywords`
  - +2 if budget is within range (both min and max set)
  - +1 if region matches `region_filter`
  - +1 if deadline is within 7 days (urgent)
  Sort by score descending.

  ## Step 5 — Generate report (Markdown)
  Header: date, portals checked, total new matches found.

  For each new tender (up to 20):
  - **Title** (link if available)
  - Budget: XXX 万元 | Deadline: YYYY-MM-DD | Region: XX
  - Matched keywords: [list]
  - Urgency tag if deadline ≤ 7 days: ⚠️ 截止临近

  If zero new tenders: "本次扫描未发现新机会。"

  Footer disclaimer: "以上信息来自公开页面，请以官方公告为准。"
  Output language follows `output_language` config.

  ## Step 6 — Update memory
  - Append all new tender IDs to `seen_tender_ids` (keep last 500 max, trim oldest).
  - Set `last_run_at` to current timestamp.
  - Set `last_new_count` to number of new tenders found this run.

  ## Escalation
  Escalate if:
  - ALL portal pages failed to load (possible network issue or site change).
  - A tender appears to have an extremely high budget (>10× the typical range) — may indicate a data error.
  Ask the user to verify the portal URL or check the page manually.

config_schema:
  - key: portal_urls
    label: Portal URLs
    type: text
    required: true
    placeholder: "https://www.ccgp.gov.cn/cggg/zygg/\nhttps://www.bidcenter.com.cn/"
    description: One URL per line. These pages will be scanned for new tenders on each run.

  - key: keywords
    label: Keywords
    type: string
    required: true
    placeholder: "软件开发, 信息系统, 云服务"
    description: Comma-separated keywords. A tender matches if its title or description contains any of them.

  - key: region_filter
    label: Region Filter
    type: string
    required: false
    placeholder: "北京"
    description: Only include tenders from this region. Leave blank to include all regions.

  - key: min_budget
    label: Min Budget (CNY 万元)
    type: number
    required: false
    default: 0
    description: Minimum estimated value in 万元. Set to 0 for no lower limit.

  - key: max_budget
    label: Max Budget (CNY 万元)
    type: number
    required: false
    default: 0
    description: Maximum estimated value in 万元. Set to 0 for no upper limit.

  - key: output_language
    label: Output Language
    type: select
    required: true
    default: zh-CN
    options:
      - label: 中文
        value: zh-CN
      - label: English
        value: en-US

subscriptions:
  - id: daily-scan
    source:
      type: schedule
      config:
        cron: "0 9 * * *"
    frequency:
      default: 24h
      min: 6h
      max: 24h

requires:
  mcps:
    - id: ai-browser
      reason: Required to open procurement portal pages and extract tender listings

memory_schema:
  seen_tender_ids:
    type: array
    description: Stable IDs of tenders already reported — used to suppress duplicates (capped at 500)
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
  last_new_count:
    type: number
    description: Number of new tenders found in the last run

output:
  notify:
    system: true
  format: markdown

permissions:
  - ai-browser

escalation:
  enabled: true
  timeout_hours: 48

store:
  slug: tender-radar
  category: productivity
  tags: [tender, procurement, government, monitor, b2b]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol

i18n:
  zh-CN:
    name: 招投标机会雷达
    description: 每天扫描政府采购和企业招标平台，按关键词、预算、地区筛选新机会，输出优先级排序的机会清单。
    config_schema:
      portal_urls:
        label: 招标平台地址
        description: 每行一个网址，这些页面将在每次运行时被扫描。
        placeholder: "https://www.ccgp.gov.cn/cggg/zygg/\nhttps://www.bidcenter.com.cn/"
      keywords:
        label: 关键词
        description: 逗号分隔。标题或描述包含任意关键词即视为匹配。
        placeholder: "软件开发, 信息系统, 云服务"
      region_filter:
        label: 地区筛选
        description: 只显示该地区的招标信息，留空则不限制地区。
        placeholder: "北京"
      min_budget:
        label: 最低预算（万元）
        description: 预算下限（万元），设为 0 表示不限。
      max_budget:
        label: 最高预算（万元）
        description: 预算上限（万元），设为 0 表示不限。
      output_language:
        label: 输出语言
        options:
          zh-CN: 中文
          en-US: English
