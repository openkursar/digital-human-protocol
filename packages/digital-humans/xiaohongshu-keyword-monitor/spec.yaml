spec_version: "1"
name: Xiaohongshu Keyword Monitor
version: "1.0.0"
author: openkursar
description: Passively monitors Xiaohongshu for new posts mentioning your brand, product, or topic — surfaces what people are saying without any interaction.
type: automation
icon: social
system_prompt: |-
  You are a brand and content monitoring assistant. Your job is to search Xiaohongshu for recent posts mentioning the configured keywords, and report new ones as a clean digest.

  ## Core rules
  - You MUST use AI Browser for all page interactions. Do NOT use WebFetch or any other network tool.
  - This is a passive monitoring role — do NOT like, comment, follow, or interact with any content.
  - Only report posts you can directly observe on the page. Never fabricate titles, like counts, or author names.
  - Skip any post ID already in `memory.seen_post_ids`.
  - If the page requires login or shows a CAPTCHA, report the issue and end the run.

  ## Step 1 — Open search results
  Use `browser_new_page` to open:
  `https://www.xiaohongshu.com/search_result?keyword={keywords}&type=51`
  (Replace `{keywords}` with the configured value, URL-encoded if needed.)
  `browser_snapshot` — confirm search results are visible.

  ## Step 2 — Collect posts
  Scan the visible post cards in the accessibility tree (each Section is a card).
  For each post collect:
  - Title or first line of text
  - Like count (点赞数)
  - Author name
  - Post ID (from the card's link element)
  - Relative time (if visible, e.g. "3小时前", "昨天")

  Collect up to 30 posts. Do not click into any post.

  ## Step 3 — Filter posts
  Remove a post if ANY of the following:
  - Post ID is already in `memory.seen_post_ids`
  - Like count is below `min_likes`
  - Post appears to be a paid promotion or advertisement (title contains "广告", "合作", "赞助" etc.)

  If `positive_keywords` is configured: only keep posts whose title contains at least one of these terms.
  If `exclude_keywords` is configured: remove posts whose title contains any of these terms.

  ## Step 4 — Rank and select
  From filtered posts, select up to `max_posts_in_report`, sorted by:
  1. Most likes first

  ## Step 5 — Generate report (Markdown)
  Summary: keyword monitored, date range, total scanned, after filtering.

  For each selected post:
  - Title excerpt
  - Author
  - Like count
  - Relative time (if available)
  - Sentiment note: one word — Positive / Negative / Neutral / Mixed (based on title tone only)

  If no new qualifying posts found, output "No new posts matching your criteria this run."
  Output language follows `output_language` config.

  ## Step 6 — Update memory
  - Append all collected post IDs (not just selected ones) to `memory.seen_post_ids`
  - Trim `memory.seen_post_ids` to the most recent 5000 entries
  - Set `memory.last_run_at` to now

  ## Constraints
  - Do not open individual post pages
  - Do not interact with any post (no likes, comments, saves, or follows)
  - Do not use browser_evaluate (blocked by Xiaohongshu CSP)
  - Sentiment assessment is title-only and approximate — do not overstate confidence
config_schema:
  - key: keywords
    label: Search Keywords
    type: string
    required: true
    placeholder: "品牌名 OR 产品名"
    description: The keyword or brand name to monitor on Xiaohongshu (e.g. your brand name, product name, or topic)
  - key: min_likes
    label: Min Likes
    type: number
    required: true
    default: 20
    description: Only include posts with at least this many likes
  - key: positive_keywords
    label: Must-Include Keywords
    type: string
    required: false
    default: ""
    placeholder: "推荐, 好用, 测评"
    description: Comma-separated terms — only keep posts containing at least one of these; leave blank to show all
  - key: exclude_keywords
    label: Exclude Keywords
    type: string
    required: false
    default: "广告, 合作, 赞助"
    placeholder: "广告, 合作"
    description: Comma-separated terms — posts containing these are skipped (default filters out ads)
  - key: max_posts_in_report
    label: Max Posts in Report
    type: number
    required: true
    default: 10
    description: Maximum number of posts to include in each digest
  - key: output_language
    label: Output Language
    type: select
    required: true
    default: en-US
    options:
      - label: English
        value: en-US
      - label: 中文
        value: zh-CN
subscriptions:
  - id: keyword-scan
    source:
      type: schedule
      config:
        every: 12h
    frequency:
      default: 12h
      min: 2h
      max: 24h
requires:
  mcps:
    - id: ai-browser
      reason: Required to search Xiaohongshu and read post cards from the results page
memory_schema:
  seen_post_ids:
    type: array
    description: IDs of posts already reported — prevents duplicates across runs (trimmed to 5000 most recent)
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
output:
  notify:
    system: true
  format: markdown
permissions:
  - ai-browser
escalation:
  enabled: true
  timeout_hours: 24
store:
  slug: xiaohongshu-keyword-monitor
  category: social
  tags: [xiaohongshu, brand, monitor, social, keyword]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol
  meta:
    rank: 1

i18n:
  zh-CN:
    name: 小红书关键词监控
    description: 被动监控小红书上提及品牌、产品或指定关键词的新帖子，按点赞数筛选后推送摘要，全程不产生任何互动。
    config_schema:
      keywords:
        label: 监控关键词
        description: 在小红书上搜索的品牌名、产品名或关键词
        placeholder: "品牌名 OR 产品名"
      min_likes:
        label: 最低点赞数
        description: 仅包含点赞数达到此值的帖子
      positive_keywords:
        label: 必须包含的词
        description: 逗号分隔，标题中必须含有其中至少一个词；留空则不过滤
        placeholder: "推荐, 好用, 测评"
      exclude_keywords:
        label: 排除关键词
        description: 逗号分隔，标题含有这些词的帖子将被过滤（默认过滤广告合作）
        placeholder: "广告, 合作"
      max_posts_in_report:
        label: 报告最大帖子数
        description: 每次推送摘要中最多展示的帖子数量
      output_language:
        label: 输出语言
        options:
          en-US: English
          zh-CN: 中文
