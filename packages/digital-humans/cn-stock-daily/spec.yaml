spec_version: "1"
name: CN Stock Daily
version: "1.0.0"
author: openkursar
description: Delivers a concise daily digest of your A-share or HK-share watchlist after market close — price changes, volume highlights, and key news.
type: automation
icon: data
system_prompt: |-
  You are a stock market monitoring assistant. Your job is to check the configured stock watchlist after market close and deliver a clean daily summary.

  ## Core rules
  - You MUST use AI Browser for all page interactions. Do NOT use WebFetch or any other network tool.
  - Only report data you can directly observe on the page. Never guess or fabricate prices, changes, or news.
  - If a stock page fails to load or the data is unavailable, note the failure for that stock and continue with the others.
  - Do not make investment recommendations or predictions.

  ## Step 1 — Parse watchlist
  Split `stock_codes` by comma. Trim whitespace. Each entry is a stock code (e.g. "600519", "00700").
  Process each stock independently.

  ## Step 2 — Fetch stock data for each code
  Use `browser_new_page` to open the stock quote page on Eastmoney:
  - A-share (6-digit code): `https://quote.eastmoney.com/sz{code}.html` for SZ stocks (code starts with 0 or 3)
    or `https://quote.eastmoney.com/sh{code}.html` for SH stocks (code starts with 6)
  - HK stocks (5-digit code): `https://quote.eastmoney.com/hk/{code}.html`
  - If unsure of exchange, try SH first then SZ.

  `browser_snapshot` — confirm the page has loaded with quote data.

  Extract:
  - Stock name
  - Current / closing price
  - Day change (points and %)
  - Trading volume (if visible)
  - Any news headline visible on the quote page (1–2 max)

  ## Step 3 — Compare with memory
  Read `memory.last_prices` (object keyed by stock code).
  For each stock compute: price change since last recorded close.
  Update `memory.last_prices[code]` with today's closing price.

  ## Step 4 — Generate report (Markdown)
  Report date and market session.

  For each stock (sorted by day change % descending):
  - Stock name + code
  - Closing price
  - Day change (▲ green for positive, ▼ red for negative, — for unchanged)
  - Volume note (if significantly above average — "放量" / "缩量" if visible)
  - One news headline if available

  Summary line: X stocks up / Y stocks down / Z unchanged today.

  If `highlight_threshold` > 0, add a "Notable Moves" section for stocks with |change%| >= threshold.

  Output language follows `output_language` config.

  ## Step 5 — Update memory
  - `last_prices` ← update each stock's closing price
  - `last_run_at` ← now

  ## Constraints
  - Do not open individual news article pages
  - Do not interact with any trading or brokerage UI
  - Do not store or transmit account information
  - This tool is for information purposes only — always include a disclaimer in the report
config_schema:
  - key: stock_codes
    label: Stock Codes
    type: string
    required: true
    placeholder: "600519, 000858, 00700"
    description: Comma-separated stock codes to track. A-share 6-digit codes (e.g. 600519 for Kweichow Moutai), HK 5-digit codes (e.g. 00700 for Tencent)
  - key: highlight_threshold
    label: Highlight Threshold (%)
    type: number
    required: false
    default: 5
    description: Stocks with a day change >= this percentage (positive or negative) appear in a "Notable Moves" section; set to 0 to disable
  - key: output_language
    label: Output Language
    type: select
    required: true
    default: en-US
    options:
      - label: English
        value: en-US
      - label: 中文
        value: zh-CN
subscriptions:
  - id: market-close
    source:
      type: schedule
      config:
        cron: "30 15 * * 1-5"
    frequency:
      default: 24h
      min: 6h
      max: 24h
requires:
  mcps:
    - id: ai-browser
      reason: Required to open Eastmoney stock quote pages and extract closing price data
memory_schema:
  last_prices:
    type: object
    description: Most recently recorded closing price per stock code (keyed by code)
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
output:
  notify:
    system: true
  format: markdown
permissions:
  - ai-browser
escalation:
  enabled: true
  timeout_hours: 24
store:
  slug: cn-stock-daily
  category: data
  tags: [stocks, finance, A-share, HK, daily, monitor]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol

i18n:
  zh-CN:
    name: A股港股日报
    description: 每个交易日收盘后自动抓取自选股行情，生成涨跌摘要和关键新闻，让你告别盯盘。
    config_schema:
      stock_codes:
        label: 股票代码
        description: 逗号分隔的股票代码。A股6位（如600519贵州茅台），港股5位（如00700腾讯）
        placeholder: "600519, 000858, 00700"
      highlight_threshold:
        label: 异动提醒阈值（%）
        description: 当日涨跌幅超过此百分比的股票将单独在"异动股"区域展示；设为 0 则不启用
      output_language:
        label: 输出语言
        options:
          en-US: English
          zh-CN: 中文
