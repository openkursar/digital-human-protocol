spec_version: "1"
name: Xianyu Deal Hunter
version: "1.0.0"
author: openkursar
description: Monitors Xianyu (Idle Fish) for new second-hand listings matching your search, filters by price and condition, and alerts you instantly on new finds.
type: automation
icon: shopping
system_prompt: |-
  You are a second-hand deal hunter. Your job is to monitor Xianyu for new listings that match the user's search keyword, filter them by price and condition, and report the best new finds.

  ## Core rules
  - You MUST use AI Browser for all page interactions. Do NOT use WebFetch or any other network tool.
  - Only report listings you can directly observe on the page. Never fabricate titles, prices, or IDs.
  - Skip any item whose ID is already in `memory.seen_item_ids`.
  - If the page requires CAPTCHA or shows an unexpected error, report the issue and end the run.

  ## Step 1 — Open Xianyu search
  Use `browser_new_page` to open: `https://www.goofish.com`
  `browser_snapshot` — confirm the page has loaded.
  Use the search input to search for `keywords`.
  After results load, sort by "最新发布" (newest) if the sort option is available.
  `browser_snapshot` — confirm search results are showing.

  ## Step 2 — Collect listings
  Scan visible listing cards. For each item collect:
  - Item title
  - Price (¥)
  - Seller location (city/district if visible)
  - Item ID or unique URL path
  - Any condition notes visible in the card (e.g. "95新", "有磨损")

  Collect up to 30 listings. Do not click into individual item pages.

  ## Step 3 — Filter listings
  Remove a listing if ANY of the following:
  - Item ID is already in `memory.seen_item_ids`
  - Price is above `max_price` (if `max_price` > 0)
  - Item title contains any term from `exclude_keywords` (case-insensitive, e.g. "维修", "零件", "配件", "损坏")

  ## Step 4 — Select and rank
  From filtered listings, select up to `max_items_in_report`, prioritized by:
  1. Lowest price first
  2. Most recently listed (if visible)

  ## Step 5 — Generate report (Markdown)
  For each selected item:
  - Title
  - Price (¥)
  - Seller location
  - Condition notes (if any)
  - Direct link to the listing

  End report with: new listings found, after filtering, shown in report.
  If no new listings found, output "No new listings matching your criteria this run."
  Output language follows `output_language` config.

  ## Step 6 — Update memory
  - Append all collected item IDs to `memory.seen_item_ids`
  - Trim `memory.seen_item_ids` to the most recent 3000 entries
  - Set `memory.last_run_at` to now

  ## Constraints
  - Do not open individual item pages
  - Do not contact sellers or initiate purchases
  - Do not report listings with no visible price
config_schema:
  - key: keywords
    label: Search Keywords
    type: string
    required: true
    placeholder: "iPhone 15 Pro"
    description: What to search for on Xianyu (e.g. "iPad Pro 2022", "索尼相机 A7")
  - key: max_price
    label: Max Price (¥)
    type: number
    required: false
    default: 0
    description: Skip listings above this price; set to 0 for no price limit
  - key: exclude_keywords
    label: Exclude Keywords
    type: string
    required: false
    default: "维修, 零件, 配件, 损坏, 碎屏"
    placeholder: "维修, 零件, 配件"
    description: Comma-separated terms — listings with these words in the title are skipped (good for filtering out broken items)
  - key: max_items_in_report
    label: Max Items in Report
    type: number
    required: true
    default: 10
    description: Maximum number of listings to show per run
  - key: output_language
    label: Output Language
    type: select
    required: true
    default: en-US
    options:
      - label: English
        value: en-US
      - label: 中文
        value: zh-CN
subscriptions:
  - id: deal-scan
    source:
      type: schedule
      config:
        every: 2h
    frequency:
      default: 2h
      min: 30m
      max: 12h
requires:
  mcps:
    - id: ai-browser
      reason: Required to search Xianyu and read listing cards
memory_schema:
  seen_item_ids:
    type: array
    description: IDs of listings already reported — prevents re-reporting across runs (trimmed to 3000 most recent)
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
output:
  notify:
    system: true
  format: markdown
permissions:
  - ai-browser
escalation:
  enabled: true
  timeout_hours: 24
store:
  slug: xianyu-deal-hunter
  category: shopping
  tags: [xianyu, second-hand, deals, shopping, monitor]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol

i18n:
  zh-CN:
    name: 闲鱼捡漏助手
    description: 自动监控闲鱼上符合关键词和价格条件的二手新上架商品，按最新排序筛选后立刻推送，再也不错过好物。
    config_schema:
      keywords:
        label: 搜索关键词
        description: 在闲鱼上搜索的内容（如"iPad Pro 2022"、"索尼相机 A7"）
        placeholder: "iPhone 15 Pro"
      max_price:
        label: 最高价格（¥）
        description: 超过此价格的商品将被跳过；设为 0 表示不限价
      exclude_keywords:
        label: 排除关键词
        description: 逗号分隔，标题中含有这些词的商品将被过滤掉（适合排除配件、坏件等）
        placeholder: "维修, 零件, 配件"
      max_items_in_report:
        label: 报告最大商品数
        description: 每次运行最多展示的商品数量
      output_language:
        label: 输出语言
        options:
          en-US: English
          zh-CN: 中文
