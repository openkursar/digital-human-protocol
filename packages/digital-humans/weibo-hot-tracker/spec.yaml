spec_version: "1"
name: Weibo Hot Tracker
version: "2.0.0"
author: openkursar
description: Tracks Weibo trending topics and reports meaningful rank changes — new entries, significant rises, and notable drops.
type: automation
icon: social
system_prompt: |-
  You are a social trend monitoring assistant. Your job is to track Weibo's hot topic list and report meaningful changes since the last run.

  ## Core rules
  - You MUST use AI Browser to visit the Weibo trending page. Do NOT use WebFetch or any other network tool.
  - Only report information directly visible on the page. Never fabricate rankings, heat scores, or topic names.
  - Focus on change, not static snapshots. If nothing significant changed, say so clearly.
  - If the page fails to load or the structure is unrecognizable, report the failure reason and end the run.

  ## Step 1 — Fetch trending list
  Use AI Browser to open the Weibo hot topics page.
  Collect the top `top_n` entries:
  - Topic name
  - Current rank
  - Heat indicator (if visible)
  - Tag label (新/热/沸, if visible)

  ## Step 2 — Compute changes
  Compare with `memory.last_hot_snapshot`:
  - New entries: topics not present in the previous snapshot
  - Rising: rank improved by >= `min_rank_change`
  - Falling: rank dropped by >= `min_rank_change`
  - Stable top: topics that have held a top-10 position across >= 2 consecutive runs

  ## Step 3 — Apply keyword focus filter
  If `keyword_focus` is non-empty, surface matching topics first in each change category.

  ## Step 4 — Generate report (Markdown)
  Sections (omit sections with no items):
  - New entries
  - Significant rises
  - Significant drops
  - Stable top topics
  If no significant changes across all sections, output "No significant changes this run."
  Limit total topics across all sections to `max_topics_in_report`.
  Output language follows `output_language` config.

  ## Step 5 — Update memory
  - Overwrite `last_hot_snapshot` with this run's full snapshot.
  - Update `topic_state`: per-topic recent rank history and consecutive-top count.
  - Set `last_run_at` to now.
  - Write reported topic names to `last_report_topics` (used for dedup across runs).

  ## Constraints
  - Do not editorialize on topic content or make political judgments.
  - Do not report unverified claims about why a topic is trending.
config_schema:
  - key: top_n
    label: Top N
    type: number
    required: true
    default: 30
    description: Number of top trending entries to fetch per run
  - key: min_rank_change
    label: Min Rank Change
    type: number
    required: true
    default: 5
    description: Minimum rank position change to be considered significant
  - key: max_topics_in_report
    label: Max Topics in Report
    type: number
    required: true
    default: 10
    description: Maximum total topics to include across all sections of the report
  - key: keyword_focus
    label: Keyword Focus
    type: string
    required: false
    default: ""
    placeholder: "AI, LLM, Agent"
    description: Comma-separated keywords to prioritize in the report; leave blank to show all
  - key: output_language
    label: Output Language
    type: select
    required: true
    default: en-US
    options:
      - label: English
        value: en-US
      - label: 中文
        value: zh-CN
subscriptions:
  - id: hot-topics
    source:
      type: schedule
      config:
        every: 2h
    frequency:
      default: 2h
      min: 30m
      max: 12h
requires:
  mcps:
    - id: ai-browser
      reason: Required to open the Weibo trending page and read current rankings
memory_schema:
  last_hot_snapshot:
    type: array
    description: Full trending list from the previous run (topic, rank, heat, tag)
  topic_state:
    type: object
    description: Per-topic tracking state (recent rank history, consecutive-top count)
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
  last_report_topics:
    type: array
    description: Topic names included in the last report — used to suppress noise across runs
output:
  notify:
    system: true
  format: markdown
permissions:
  - ai-browser
escalation:
  enabled: true
  timeout_hours: 24
store:
  slug: weibo-hot-tracker
  category: social
  tags: [weibo, trends, social, monitoring]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol

i18n:
  zh-CN:
    name: 微博热点追踪
    description: 追踪微博热搜榜单的排名变化，报告新上榜、显著上升和显著下降的热点话题。
    config_schema:
      top_n:
        label: 追踪条数
        description: 每次运行抓取的热搜条目数量
      min_rank_change:
        label: 最小排名变化
        description: 被视为显著变化的最小名次变动幅度
      max_topics_in_report:
        label: 报告最大话题数
        description: 报告中所有分类下话题的总数上限
      keyword_focus:
        label: 关键词过滤
        description: 逗号分隔的关键词，匹配的话题将优先展示；留空则显示所有
        placeholder: "AI, 大模型, Agent"
      output_language:
        label: 输出语言
        options:
          en-US: English
          zh-CN: 中文
