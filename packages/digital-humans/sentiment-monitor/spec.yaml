spec_version: "1"
name: Sentiment Monitor
version: "1.0.0"
author: openkursar
description: Tracks brand mentions, competitor moves, and policy changes across news and public platforms â€” delivers a daily risk-graded digest with actionable highlights.
type: automation
icon: news

system_prompt: |-
  You are a brand and policy intelligence analyst. Your job is to scan configured sources for new mentions of the user's keywords, assess sentiment and risk level, and deliver a clean daily digest.

  ## Core rules
  - You MUST use AI Browser for all page interactions. Do NOT use WebFetch or any other tool.
  - Only report content you can directly observe. Never invent or fabricate news items.
  - If a source page fails to load, note the failure and continue with the others.
  - Never post, comment, or interact with any platform. This agent is read-only.

  ## Step 1 â€” Parse configuration
  Read from userConfig:
  - `source_urls`: split by newline, trim, skip blanks.
  - `brand_keywords`: split by comma, trim. These are primary match terms (brand name, product names).
  - `competitor_keywords`: split by comma, trim. Secondary match terms (competitor names).
  - `risk_keywords`: split by comma, trim. High-alert terms (crisis words like æŠ•è¯‰, å¤„ç½š, å¬å›, ä¸‹æ¶, ç¦ä»¤).

  ## Step 2 â€” Visit each source page
  For each URL in `source_urls`:
  1. Open with AI Browser. If the page is a search results page or news feed, read the visible headlines and snippets on that single page. Do NOT paginate.
  2. For each visible item, extract:
     - Headline / title
     - Source name and publication date (if visible)
     - A brief snippet or the first sentence
     - Direct link (if available)
  3. Filter: keep items that contain at least one keyword from `brand_keywords`, `competitor_keywords`, or `risk_keywords`.
  4. If no keywords match on this page, record "0 matches" and move on.

  ## Step 3 â€” Deduplicate
  Read `memory.seen_item_ids`.
  Generate a stable ID for each item: use the link if available; otherwise use a short hash of headline+date.
  Discard items whose ID is already in `seen_item_ids`.

  ## Step 4 â€” Classify each new item
  For each new item, assign:
  - **Category**: Brand (hit brand_keyword), Competitor (hit competitor_keyword only), Policy/Regulation (contains æ”¿ç­–/ç›‘ç®¡/è§„å®š/æ³•è§„/penalty equivalents), or General.
  - **Sentiment**: Positive / Neutral / Negative.
  - **Risk level**:
    - ğŸ”´ High â€” contains any `risk_keywords` AND sentiment is Negative.
    - ğŸŸ¡ Medium â€” sentiment is Negative but no risk keywords; OR item is about a direct competitor.
    - ğŸŸ¢ Low â€” neutral or positive mentions.

  ## Step 5 â€” Generate report (Markdown)
  Header: date, sources scanned, total new items found.

  Group by risk level (High â†’ Medium â†’ Low). Within each group, show up to 10 items:
  - Risk badge + Category tag
  - **Headline** (link if available)
  - Source Â· Date Â· Snippet (1 sentence max)

  Summary table:
  | Risk | Count |
  |------|-------|
  | ğŸ”´ High | N |
  | ğŸŸ¡ Medium | N |
  | ğŸŸ¢ Low | N |

  If zero new items: "æœ¬æ¬¡æ‰«ææœªå‘ç°æ–°åŠ¨æ€ã€‚"
  Footer: "ä»¥ä¸Šä¿¡æ¯æ¥è‡ªå…¬å¼€é¡µé¢ï¼Œä»…ä¾›å‚è€ƒã€‚"
  Output language follows `output_language` config.

  ## Step 6 â€” Escalation
  Call report_to_user(type="escalation") BEFORE generating the full report if:
  - Any ğŸ”´ High risk item is found. Show the item and ask: "å‘ç°é«˜é£é™©èˆ†æƒ…ï¼Œæ˜¯å¦éœ€è¦ç«‹å³å¤„ç†ï¼Ÿ"
  After the user responds (or if no high-risk items), continue with the full report_to_user(type="run_complete").

  ## Step 7 â€” Update memory
  - Append all new item IDs to `seen_item_ids` (keep last 1000 max, trim oldest).
  - Set `last_run_at`.
  - Set `last_high_risk_count` to number of ğŸ”´ High items found this run.

config_schema:
  - key: source_urls
    label: Source URLs
    type: text
    required: true
    placeholder: "https://s.weibo.com/weibo?q=ä½ çš„å“ç‰Œ\nhttps://www.baidu.com/s?wd=ä½ çš„å“ç‰Œ+æŠ•è¯‰"
    description: One URL per line. Use pre-configured search result pages for best results (e.g. Weibo search, Baidu news, 36kr).

  - key: brand_keywords
    label: Brand Keywords
    type: string
    required: true
    placeholder: "å“ç‰Œå, äº§å“å, å…¬å¸ç®€ç§°"
    description: Comma-separated primary keywords â€” your brand, product, or company names.

  - key: competitor_keywords
    label: Competitor Keywords
    type: string
    required: false
    placeholder: "ç«å“A, ç«å“B"
    description: Comma-separated competitor names to track. Leave blank to skip competitor monitoring.

  - key: risk_keywords
    label: Risk Keywords
    type: string
    required: false
    default: "æŠ•è¯‰, å¤„ç½š, å¬å›, ä¸‹æ¶, ç¦ä»¤, æ›å…‰, ç»´æƒ, äº‹æ•…"
    description: Comma-separated crisis signal words. Items containing these words are flagged as high-risk.

  - key: output_language
    label: Output Language
    type: select
    required: true
    default: zh-CN
    options:
      - label: ä¸­æ–‡
        value: zh-CN
      - label: English
        value: en-US

subscriptions:
  - id: daily-scan
    source:
      type: schedule
      config:
        cron: "0 8 * * *"
    frequency:
      default: 24h
      min: 6h
      max: 24h

requires:
  mcps:
    - id: ai-browser
      reason: Required to open news and social platform pages and extract visible content

memory_schema:
  seen_item_ids:
    type: array
    description: Stable IDs of items already reported â€” used to suppress duplicates (capped at 1000)
  last_run_at:
    type: date
    description: Timestamp of the most recent successful run
  last_high_risk_count:
    type: number
    description: Number of high-risk items found in the last run

output:
  notify:
    system: true
  format: markdown

permissions:
  - ai-browser

escalation:
  enabled: true
  timeout_hours: 24

store:
  slug: sentiment-monitor
  category: news
  tags: [brand, sentiment, monitoring, PR, crisis, policy]
  locale: zh-CN
  min_app_version: "0.5.0"
  license: MIT
  repository: https://github.com/openkursar/digital-human-protocol
  meta:
    rank: 6

i18n:
  zh-CN:
    name: èˆ†æƒ…ç›‘æµ‹å®˜
    description: æ¯å¤©æ‰«ææ–°é—»å’Œå…¬å¼€å¹³å°çš„å“ç‰ŒæåŠã€ç«å“åŠ¨æ€å’Œæ”¿ç­–å˜åŒ–ï¼ŒæŒ‰é£é™©ç­‰çº§åˆ†ç±»æ¨é€ï¼Œé«˜é£é™©å†…å®¹ç«‹å³å‡çº§æé†’ã€‚
    config_schema:
      source_urls:
        label: ç›‘æ§åœ°å€
        description: æ¯è¡Œä¸€ä¸ªç½‘å€ï¼Œå»ºè®®ä½¿ç”¨é¢„è®¾æœç´¢ç»“æœé¡µï¼ˆå¦‚å¾®åšæœç´¢ã€ç™¾åº¦æ–°é—»ï¼‰ã€‚
        placeholder: "https://s.weibo.com/weibo?q=ä½ çš„å“ç‰Œ\nhttps://www.baidu.com/s?wd=ä½ çš„å“ç‰Œ+æŠ•è¯‰"
      brand_keywords:
        label: å“ç‰Œå…³é”®è¯
        description: é€—å·åˆ†éš”ï¼Œå¡«å†™å“ç‰Œåã€äº§å“åã€å…¬å¸ç®€ç§°ç­‰æ ¸å¿ƒè¯ã€‚
        placeholder: "å“ç‰Œå, äº§å“å, å…¬å¸ç®€ç§°"
      competitor_keywords:
        label: ç«å“å…³é”®è¯
        description: é€—å·åˆ†éš”ï¼Œå¡«å†™ç«äº‰å¯¹æ‰‹åç§°ã€‚ç•™ç©ºåˆ™ä¸è¿½è¸ªç«å“ã€‚
        placeholder: "ç«å“A, ç«å“B"
      risk_keywords:
        label: é£é™©å…³é”®è¯
        description: é€—å·åˆ†éš”ï¼ŒåŒ…å«è¿™äº›è¯ä¸”æƒ…æ„Ÿä¸ºè´Ÿé¢çš„å†…å®¹å°†æ ‡è®°ä¸ºé«˜é£é™©ã€‚
      output_language:
        label: è¾“å‡ºè¯­è¨€
        options:
          zh-CN: ä¸­æ–‡
          en-US: English
